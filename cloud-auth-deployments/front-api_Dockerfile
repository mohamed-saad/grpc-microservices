FROM openjdk:11-slim-buster

WORKDIR /app

ARG THE_USER_ID=1001
ARG THE_GROUP_ID=1001
RUN DEBIAN_FRONTEND=noninteractive && \
/usr/sbin/groupadd -g $THE_GROUP_ID spring && \
/usr/sbin/useradd -l -u $THE_USER_ID -G spring -g $THE_GROUP_ID spring && \
mkdir logs && chgrp spring logs && chmod ug+rwx logs

COPY . /app
RUN ./gradlew front-api:bootJar

USER spring:spring

EXPOSE 8080
CMD ["java", "-jar", "-Dserver.port=8080", "front-api/build/libs/front-api.jar", "audit-service-svc.incorta-x-demo.svc.cluster.local:8080", "compute-service-0.compute-service-svc.incorta-x-demo.svc.cluster.local:8080,compute-service-1.compute-service-svc.incorta-x-demo.svc.cluster.local:8080,compute-service-2.compute-service-svc.incorta-x-demo.svc.cluster.local:8080"]
