FROM openjdk:11-slim-buster

WORKDIR /app

ARG THE_USER_ID=1001
ARG THE_GROUP_ID=1001
RUN DEBIAN_FRONTEND=noninteractive && \
/usr/sbin/groupadd -g $THE_GROUP_ID spring && \
/usr/sbin/useradd -l -u $THE_USER_ID -G spring -g $THE_GROUP_ID spring && \
mkdir logs && chgrp spring logs && chmod ug+rwx logs

COPY . /app
RUN ./gradlew micro-a-replica:jar

USER spring:spring

EXPOSE 8080
CMD ["java", "-jar", "micro-a-replica/build/libs/micro-a-replica-plain.jar", "8080"]
